{"version":3,"sources":["../src/route.page.js"],"names":["express","require","router","Router","PostModel","marked","MarkdownIt","config","auth","md","get","req","res","next","console","log","render","title","adminRequired","send","id","query","findOne","_id","err","article","content","session","user","clearCookie","cookieName","path","redirect","module","exports"],"mappings":"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","file":"route.page.js","sourcesContent":["var express = require('express');\nvar router = express.Router();\nvar PostModel = require('./models/post');\nvar marked = require('marked');\nvar MarkdownIt = require('markdown-it');\nvar config = require('./config');\nvar auth = require('./middlewares/auth');\n\nvar md = new MarkdownIt();\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n    console.log(\"Get / page\");\n  res.render('index', { title: 'My first web app' });\n});\n\n// GET users page\nrouter.get('/users', auth.adminRequired, function(req, res, next){\n    console.log('Get /users page');\n    res.send(\"zhangsan\\n lisi\\n wangerwangzi\");\n});\n\n// GET posts page\nrouter.get('/posts', function(req, res, next){\n    console.log('Get posts page');\n    res.render('posts', {title: 'Hello posts'});\n});\n\n\n// GET create page\nrouter.get('/posts/create', auth.adminRequired, function(req, res, next){\n    console.log(\"Get create page\");\n    res.render('create', {title: 'create'});\n});\n\n\n// GET the specific ariticle content\nrouter.get('/posts/show', function(req, res, next){\n  console.log(\"Get /posts/show specific ariticle detail\");\n  var id = req.query.id;\n  // 这里的function第一个参数是错误，第二个就是我们查询得到的结果。\n  // PostModel.findOne({_id: id}, function(err, article){\n  //   res.render('show', {article});\n  // });\n  // 测试箭头函数\n  PostModel.findOne({_id: id}, (err, article) => {\n    // markdown 使用\n    // article.content = marked(article.content);\n\n    if (err){\n      next(err);\n      return;\n    }\n    // 使用markdown-it渲染\n    article.content = md.render(article.content);\n    res.render('show', {article});\n  });\n});\n\n// get edit page\nrouter.get('/posts/edit',  function(req, res, next){\n  var id = req.query.id;\n\n  res.render('edit', { id });\n\n});\n\n// GET signup page\nrouter.get('/signup', function(req, res, next){\n  res.render('signup');\n});\n\n// GET signin  page\nrouter.get('/signin', function(req, res, next){\n  console.log('page signin');\n  res.render('signin');\n});\n\n// GET signout page\nrouter.get('/signout', function(req, res, next){\n  console.log('signout page ');\n  // res.locals.currentUser = null;\n\n  // var authToken = req.signedCookies[config.cookieName] || '';;\n  // var opts = {\n  //   path: '/',\n  //   // maxAge: 1000 * 60 * 60 * 24 * 30, //cookie 有效期30天\n  //   // maxAge: -1,     // 只有浏览器打开的这段时间有效，关闭之后无效\n  //   maxAge: 0, // 不记录cookie\n  //   signed: true,\n  //   httpOnly: true\n  // };\n  // res.cookie(config.cookieName, authToken, opts);\n  // res.render('signout');\n  req.session.user = null;  // 因为使用了session来确定登录情况，所以要去掉req中的session的信息\n  res.clearCookie(config.cookieName, {path: '/'});\n  console.log('Clear the cookie: ' + config.cookieName);\n  res.redirect('/');\n});\n\n\nmodule.exports = router;\n"]}